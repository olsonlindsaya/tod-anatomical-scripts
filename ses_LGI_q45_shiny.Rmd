---
title: "ses_LGI_results_q45"
author: "Lindsay Olson"
date: "2/9/2021"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}

library(float)
library(tidyverse)
library(knitr)
library(ggplot2)
library(knitr)
library(MBESS)
library(dplyr)
library(ppcor)
library(corrplot)
library(Hmisc)
library(dplyr)
library(kableExtra)
#library(pander)
library(sjPlot)
library(sjmisc)
library(sjlabelled)
#library(stargazer)
library(shiny)
library(rsconnect)


options(digits = 4, scipen = 999)


knitr::opts_chunk$set(warning=FALSE, message=FALSE, error = FALSE)

```


```{r, data-readin, include=FALSE, echo=FALSE, warning=FALSE}

# Read in dataset

#LGI Data 
rm(list=ls()) ## clear the workspace
#dev.off() ## Clear the plots


anat_data = read.csv('/Users/lolson/Documents/001_JDP/001_BDIL/006_Projects/11_ToddlerSES/todanatomicaldata/tod-anatomical-scripts/SES_Anat_v2_q45.csv')

## Recode some Vars
anat_data$dxCoded <- as.factor(anat_data$Dx) # 1 = ASD, 2 = TD
anat_data$dxCoded <-unclass(anat_data$dxCoded)
 
anat_data$sexCoded <- as.factor(anat_data$SEX) # 1 = Female, 2 = Male
anat_data$sexCoded <-unclass(anat_data$sexCoded)



```

## Bivariate Correlation Plots
```{r corrplots, include=TRUE, echo=FALSE, warning=FALSE,  fig.show='asis', fig.width=7, fig.asp=1, fig.cap='Bivariate Plot'}



SES_Lang_LGI <- rcorr(as.matrix(anat_data[,c("dxCoded", "MEL_cat", "INR", "SES1", "SES2", "zipIncome","lh_transversetemporal_lgi", "rh_transversetemporal_lgi", "lh_superiortemporal_lgi", "rh_superiortemporal_lgi", "lh_middletemporal_lgi", "rh_middletemporal_lgi", "lh_parsopercularis_lgi", "rh_parsopercularis_lgi", "lh_parsorbitalis_lgi", "rh_parsorbitalis_lgi", "lh_parstriangularis_lgi", "rh_parstriangularis_lgi", "TBV")], use="pairwise.complete.obs"))

#mypath <- file.path("/Users/lolson/Documents/001_JDP/001_BDIL/006_Projects/11_ToddlerSES/todanatomicaldata/corrPlots/LGI", "SES_LGI_varsCorr_q45.tiff")
#tiff(file=mypath,width = 10, height = 10, units = 'in', res = 300)
corrplot(SES_Lang_LGI$r, method = "color",  type = "lower", outline = T, addgrid.col = "darkgray", order="original", 
         cl.pos = "b", tl.col = "indianred4", tl.srt = 45,
         p.mat = SES_Lang_LGI$P, sig.level = 0.05, insig = "blank",
         tl.cex = .75, cl.cex = .75, addCoef.col = "white", number.digits = 2, number.cex = 0.5, 
         col = colorRampPalette(c("midnightblue","white","darkred"))(100))
#dev.off()
```

## Bivariate correlations, ASD Only
```{r corrplots-ASD, include=TRUE, echo=FALSE, warning=FALSE, fig.show='asis', fig.width=7, fig.asp=1, fig.cap='Bivariate Plot ASD Only'}


anat_data_ASD <- subset(anat_data, anat_data$Dx == "ASD")

options(digits = 2)
SES_corr_ASD <- rcorr(as.matrix(anat_data_ASD[,c("MEL_cat", "INR", "SES1", "SES2", "zipIncome","lh_transversetemporal_lgi", "rh_transversetemporal_lgi", "lh_superiortemporal_lgi", "rh_superiortemporal_lgi", "lh_middletemporal_lgi", "rh_middletemporal_lgi", "lh_parsopercularis_lgi", "rh_parsopercularis_lgi", "lh_parsorbitalis_lgi", "rh_parsorbitalis_lgi", "lh_parstriangularis_lgi", "rh_parstriangularis_lgi", "TBV")], use="pairwise.complete.obs"))


corrplot(SES_corr_ASD$r, method = "color",  type = "lower",outline = T, order="original", 
         cl.pos = "b", tl.col = "indianred4", tl.srt = 45,
         p.mat = SES_Lang_LGI$P, sig.level = 0.05, insig = "blank",
         tl.cex = .75, cl.cex = .75, addCoef.col = "white", number.digits = 2, number.cex = 0.5, 
         col = colorRampPalette(c("midnightblue","white","darkred"))(100))
#dev.off()
```

## Bivariate correlations, TD Only
```{r corrplots-TD, include=TRUE, echo=FALSE, warning=FALSE, fig.show='asis', fig.width=7, fig.asp=1, fig.cap='Bivariate Plot, TD Only'}



anat_data_TD <- subset(anat_data, anat_data$Dx == "TD")

options(digits = 2)
SES_corr_TD <- rcorr(as.matrix(anat_data_TD[,c("MEL_cat", "INR", "SES1", "SES2", "zipIncome","lh_transversetemporal_lgi", "rh_transversetemporal_lgi", "lh_superiortemporal_lgi", "rh_superiortemporal_lgi", "lh_middletemporal_lgi", "rh_middletemporal_lgi", "lh_parsopercularis_lgi", "rh_parsopercularis_lgi", "lh_parsorbitalis_lgi", "rh_parsorbitalis_lgi", "lh_parstriangularis_lgi", "rh_parstriangularis_lgi", "TBV")], use="pairwise.complete.obs"))

#mypath <- file.path("/Users/lolson/Documents/001_JDP/001_BDIL/006_Projects/11_ToddlerSES/todanatomicaldata/corrPlots/LGI", #"SES_varsCorr_ASD_q45.tiff")
#tiff(file=mypath,width = 10, height = 10, units = 'in', res = 300)
corrplot(SES_corr_TD$r, method = "color",  type = "lower", outline = T, order="original", 
         cl.pos = "b", tl.col = "indianred4", tl.srt = 45,
         p.mat = SES_Lang_LGI$P, sig.level = 0.05, insig = "blank",
         tl.cex = .75, cl.cex = .75, addCoef.col = "white", number.digits = 2, number.cex = 0.5, 
         col = colorRampPalette(c("midnightblue","white","darkred"))(100))
#dev.off()
```



```{r, regTables, echo = FALSE, include=FALSE, results= 'asis'}
set.seed(1)

# number of columns in the Lung and Blood data.frames. 22,000 for you?
n <- 14
outcomes <- anat_data[,c(7:20)]
outcomeVars = names(outcomes)

anat_data$dxCoded <- as.factor(anat_data$Dx) # 1 = ASD, 2 = TD
anat_data$dxCoded <-unclass(anat_data$dxCoded)
 
anat_data$sexCoded <- as.factor(anat_data$SEX) # 1 = Female, 2 = Male
anat_data$sexCoded <-unclass(anat_data$sexCoded)


#coVars <- anat_data[,c(4:6, 36)]

#sesVars <- anat_data[,c(37:39, 41:42)]


## INR Models
# run n regressions
my_lms <- lapply(1:n, function(x) lm(outcomes[,x] ~ anat_data$INR + anat_data$TBV +anat_data$sexCoded)) # change the predictors manually

# if you need more info, get full summary call. now you can get whatever, like:
summaries <- lapply(my_lms, summary)
# ...coefficents with p values:
#sapply(summaries, function(x) x$coefficients[, c(1,4)], simplify = FALSE, USE.NAMES = TRUE)
# ...or r-squared values
#sapply(summaries, function(x) c(r_sq = x$r.squared, adj_r_sq = x$adj.r.squared))


  for (i in seq_along(outcomeVars)) {
   # cat('Linear regression results predicting', outcomeVars[[i]], '\n') 
    cat(tab_model(my_lms[i], pred.labels = c("Intercept", "Income:Needs", "TBV", "Sex"),
  dv.labels = paste(outcomeVars[[i]]),
  string.pred = "Coeffcient",
  string.ci = "CI (95%)",
  string.p = "p-Value")$knitr,"\n--------\n")
    
  }


```




## INR Results


```{r, INR Plots and tables, echo = FALSE, include=TRUE, results= 'asis'}
outcomes <- anat_data[,c(7:20)]
outcomeVars = names(outcomes)

lm1 <- lm(rh_fusiform_lgi ~  INR + TBV + V1.Age, data=anat_data, na.action = na.exclude)
cat(tab_model(lm1, pred.labels = c("Intercept", "Income:Needs", "TBV", "Age"),
  dv.labels = paste(outcomeVars[[2]]),
  string.pred = "Coeffcient",
  string.ci = "CI (95%)",
  string.p = "p-Value")$knitr,"\n--------\n")

cat("\n")
cat("\n")
cat("\n")
cat("\n")

    ggplot(anat_data, aes(x=INR, y=rh_fusiform_lgi, color=Dx, shape=Dx)) +
    geom_point() +
    geom_smooth(method=lm, aes(fill=Dx)) +
    scale_color_manual(values=c("red","blue")) +
    scale_fill_manual(values=c("red","blue")) +
    ylab('RH Fusiform LGI') +
    xlab('Income:Needs Ratio') +
    theme_classic()

cat("\n")
cat("\n")
cat("\n")
cat("\n")
cat("\n")
cat("\n")
cat("\n")
cat("\n")
    
lm2 <- lm(rh_parsopercularis_lgi ~  INR + TBV + V1.Age, data=anat_data, na.action = na.exclude)   
cat(tab_model(lm2, pred.labels = c("Intercept", "Income:Needs", "TBV", "Age"),
  dv.labels = paste(outcomeVars[[10]]),
  string.pred = "Coeffcient",
  string.ci = "CI (95%)",
  string.p = "p-Value")$knitr,"\n--------\n")


cat("\n")
cat("\n")
cat("\n")
cat("\n")

    ggplot(anat_data, aes(x=INR, y=rh_parsopercularis_lgi, color=Dx, shape=Dx)) +
    geom_point() +
    geom_smooth(method=lm, aes(fill=Dx)) +
    scale_color_manual(values=c("red","blue")) +
    scale_fill_manual(values=c("red","blue")) +
    ylab('RH Pars Opercularis LGI') +
    xlab('Income:Needs Ratio') +
    theme_classic()

```

Income to needs ratio predicts rh_parsopercularis_lgi and rh_fusiform_lgi, controlling for age and TBV (dx, sex, and age not sig. predictors)





## Neighborhood Advantage Results 
  
```{r, SES1 Models, echo=FALSE, include=FALSE, results= 'asis'}
set.seed(1)

n <- 14
outcomes <- anat_data[,c(7:20)]
outcomeVars = names(outcomes)

anat_data$dxCoded <- as.factor(anat_data$Dx) # 1 = ASD, 2 = TD
anat_data$dxCoded <-unclass(anat_data$dxCoded)
 
anat_data$sexCoded <- as.factor(anat_data$SEX) # 1 = Female, 2 = Male
anat_data$sexCoded <-unclass(anat_data$sexCoded)



## SES1 Models
# run n regressions
my_lms <- lapply(1:n, function(x) lm(outcomes[,x] ~ anat_data$SES1 + anat_data$TBV + anat_data$sexCoded)) # change the predictors manually


summaries <- lapply(my_lms, summary)

  for (i in seq_along(outcomeVars)) {
   # cat('Linear regression results predicting', outcomeVars[[i]], '\n') 
    cat(tab_model(my_lms[i], pred.labels = c("Intercept", "SES1", "TBV", "Sex"),
  dv.labels = paste(outcomeVars[[i]]),
  string.pred = "Coeffcient",
  string.ci = "CI (95%)",
  string.p = "p-Value")$knitr,"\n--------\n")
    
  }


```

Neighborhood Advantage not a significant predictor of LGI when controlling for TBV and dx.





## MEL Results

```{r, MEL Models, echo=FALSE, include=FALSE, results= 'asis'}
set.seed(1)

# number of columns in the Lung and Blood data.frames. 22,000 for you?
n <- 14
outcomes <- anat_data[,c(7:20)]
outcomeVars = names(outcomes)

anat_data$dxCoded <- as.factor(anat_data$Dx) # 1 = ASD, 2 = TD
anat_data$dxCoded <-unclass(anat_data$dxCoded)
 
anat_data$sexCoded <- as.factor(anat_data$SEX) # 1 = Female, 2 = Male
anat_data$sexCoded <-unclass(anat_data$sexCoded)



## SES1 Models
# run n regressions
my_lms <- lapply(1:n, function(x) lm(outcomes[,x] ~ anat_data$MEL_cat + anat_data$TBV + anat_data$sexCoded)) # change the predictors manually


summaries <- lapply(my_lms, summary)

  for (i in seq_along(outcomeVars)) {
   # cat('Linear regression results predicting', outcomeVars[[i]], '\n') 
    cat(tab_model(my_lms[i], pred.labels = c("Intercept", "MEL", "TBV", "Sex"),
  dv.labels = paste(outcomeVars[[i]]),
  string.pred = "Coeffcient",
  string.ci = "CI (95%)",
  string.p = "p-Value")$knitr,"\n--------\n")
    
  }


```


Maternal Education not a significant predictor of LGI when controlling for TBV and dx. 

Although there is a trending (uncorrected p - 0.08) relationship between MEL and rh fusiform LGI.





## Zip-Income Results

```{r, ZipIncome Models, echo=FALSE, include=FALSE, results= 'asis'}
set.seed(1)

n <- 14
outcomes <- anat_data[,c(7:20)]
outcomeVars = names(outcomes)

anat_data$dxCoded <- as.factor(anat_data$Dx) # 1 = ASD, 2 = TD
anat_data$dxCoded <-unclass(anat_data$dxCoded)
 
anat_data$sexCoded <- as.factor(anat_data$SEX) # 1 = Female, 2 = Male
anat_data$sexCoded <-unclass(anat_data$sexCoded)


## SES1 Models
# run n regressions
my_lms <- lapply(1:n, function(x) lm(outcomes[,x] ~ anat_data$zipIncome + anat_data$TBV + anat_data$sexCoded)) # change the predictors manually


summaries <- lapply(my_lms, summary)

  for (i in seq_along(outcomeVars)) {
   # cat('Linear regression results predicting', outcomeVars[[i]], '\n') 
    cat(tab_model(my_lms[i], pred.labels = c("Intercept", "Zip-Income", "TBV", "Sex"),
  dv.labels = paste(outcomeVars[[i]]),
  string.pred = "Coeffcient",
  string.ci = "CI (95%)",
  string.p = "p-Value")$knitr,"\n--------\n")
    
  }


```


Zip-Income not a significant predictor when controlling for TBV and Dx. 




## Dx Results
Diagnosis predicts Rh superior temporal and middle temporal LGI. 

## Primary Language Resuls

```{r, PrimaryLang Models, echo=FALSE, include=FALSE, results= 'asis'}
set.seed(1)

n <- 14
outcomes <- anat_data[,c(7:20)]
outcomeVars = names(outcomes)



## SES1 Models
# run n regressions
my_lms <- lapply(1:n, function(x) lm(outcomes[,x] ~ anat_data$primaryLangCode + anat_data$TBV + anat_data$dxCoded)) # change the predictors manually


summaries <- lapply(my_lms, summary)

  for (i in seq_along(outcomeVars)) {
   # cat('Linear regression results predicting', outcomeVars[[i]], '\n') 
    cat(tab_model(my_lms[i], pred.labels = c("Intercept", "PrimaryLang", "TBV", "Dx"),
  dv.labels = paste(outcomeVars[[i]]),
  string.pred = "Coeffcient",
  string.ci = "CI (95%)",
  string.p = "p-Value")$knitr,"\n--------\n")
    
  }


```

Primary language other than English associated with lower left hemisphere pars orbitalis LGI, controlling for TBV and dx (but only six participants in this dataset have a primary language other than english)




## Sex Results
Sex predicts lh pars opercularis LGI, controlling for TBV, and age



